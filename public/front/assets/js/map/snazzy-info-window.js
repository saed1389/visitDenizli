!function(t,e){if("function"==typeof define&&define.amd)define("SnazzyInfoWindow",["module","exports"],e);else if("undefined"!=typeof exports)e(module,exports);else{var i={exports:{}};e(i,i.exports),t.SnazzyInfoWindow=i.exports}}(this,function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}();function o(t,e){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&("object"==typeof e||"function"==typeof e)?e:t}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n="snazzy-info-window-",r={h:"0px",v:"3px",blur:"6px",spread:"0px",color:"#000"},h={placement:"top",pointer:!0,openOnMarkerClick:!0,closeOnMapClick:!0,closeWhenOthersOpen:!1,showCloseButton:!0,panOnOpen:!0,edgeOffset:{top:20,right:20,bottom:20,left:20}};function p(t,e){t&&e&&Object.keys(e).forEach(function(i){t[i]=e[i]})}function a(t,e){var i=/^(-{0,1}\.{0,1}\d+(\.\d+)?)[\s|\.]*(\w*)$/;if(t&&i.test(t)){var o,s=i.exec(t);return{value:1*s[1],units:s[3]||"px",original:t}}return e?a(e):{original:e}}function l(t,e){if(t){for(;t.firstChild;)t.removeChild(t.firstChild);e&&("string"==typeof e?t.innerHTML=e:t.appendChild(e))}}function c(t){return t.charAt(0).toUpperCase()+t.slice(1)}function d(t){if(null!=t){if(t instanceof google.maps.LatLng)return t;if(void 0!==t.lat&&void 0!==t.lng)return new google.maps.LatLng(t)}return null}var u=function(t){function e(t){!function t(e,i){if(!(e instanceof i))throw TypeError("Cannot call a class as a function")}(this,e);var i,n,r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if("undefined"==typeof google)return console.warn("Snazzy Info Window: Google Maps is not defined!"),o(r);r._html=null,r._opts=(i=t,p(n={},h),p(n,i),Object.keys(h).forEach(function(t){var e=h[t];if((void 0===e?"undefined":s(e))==="object"){var i={};p(i,e),p(i,n[t]),n[t]=i}}),n),r._callbacks=r._opts.callbacks||{},r._marker=r._opts.marker,r._map=r._opts.map,r._position=d(r._opts.position),r._isOpen=!1,r._listeners=[],r._marker&&r._opts.openOnMarkerClick&&r.trackListener(google.maps.event.addListener(r._marker,"click",function(){r.getMap()||r.open()}),!0),r._position&&!r._opts.offset&&(r._opts.offset={top:"0px",left:"0px"});var a=t.placement||r._opts.position;return("string"==typeof a||a instanceof String)&&(a=a.toLowerCase()),"top"!==a&&"bottom"!==a&&"left"!==a&&"right"!==a?r._opts.placement=h.placement:r._opts.placement=a,void 0===(a=r._opts.position)||null===a||"string"==typeof a||a instanceof String||(r._opts.position=a),(void 0===r._opts.border||!0===r._opts.border)&&(r._opts.border={}),void 0===r._opts.pointer&&(r._opts.pointer=h.pointer),(void 0===r._opts.shadow||!0===r._opts.shadow)&&(r._opts.shadow={}),r}return!function t(e,i){if("function"!=typeof i&&null!==i)throw TypeError("Super expression must either be null or a function, not "+typeof i);e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i)}(e,t),i(e,[{key:"activateCallback",value:function t(e){var i=this._callbacks[e];return i?i.apply(this):void 0}},{key:"trackListener",value:function t(e,i){this._listeners.push({listener:e,persistent:i})}},{key:"clearListeners",value:function t(e){this._listeners&&(this._listeners.forEach(function(t){(e||!t.persistent)&&(google.maps.event.removeListener(t.listener),t.listener=null)}),this._listeners=this._listeners.filter(function(t){return null!=t.listener}))}},{key:"isOpen",value:function t(){return this._isOpen}},{key:"open",value:function t(){var e=this.activateCallback("beforeOpen");(void 0===e||e)&&(this._marker?this.setMap(this._marker.getMap()):this._map&&this._position&&this.setMap(this._map))}},{key:"close",value:function t(){var e=this.activateCallback("beforeClose");(void 0===e||e)&&(this.clearListeners(),this.setMap(null))}},{key:"destroy",value:function t(){this.getMap()&&this.setMap(null),this.clearListeners(!0)}},{key:"setContent",value:function t(e){this._opts.content=e,this._html&&this._html.content&&l(this._html.content,e)}},{key:"setPosition",value:function t(e){this._position=d(e),this._isOpen&&this._position&&(this.draw(),this.resize(),this.reposition())}},{key:"setWrapperClass",value:function t(e){if(this._html&&this._html.wrapper){var i=this._html.wrapper;i.className="si-wrapper-"+this._opts.placement,this._opts.border&&(i.className+=" si-has-border"),e&&(i.className+=" "+e)}this._opts.wrapperClass=e}},{key:"getWrapper",value:function t(){return this._html?this._html.wrapper:null}},{key:"draw",value:function t(){if(this.getMap()&&this._html&&(this._marker||this._position)){var e=this._opts.offset;e&&(e.left&&(this._html.wrapper.style.marginLeft=e.left),e.top&&(this._html.wrapper.style.marginTop=e.top));var i=this._opts.backgroundColor;if(i&&(this._html.contentWrapper.style.backgroundColor=i,this._opts.pointer&&(this._html.pointerBg.style["border"+c(this._opts.placement)+"Color"]=i)),this._opts.padding&&(this._html.contentWrapper.style.padding=this._opts.padding,this._opts.shadow&&(this._html.shadowFrame.style.padding=this._opts.padding)),this._opts.borderRadius&&(this._html.contentWrapper.style.borderRadius=this._opts.borderRadius,this._opts.shadow&&(this._html.shadowFrame.style.borderRadius=this._opts.borderRadius)),this._opts.fontSize&&(this._html.wrapper.style.fontSize=this._opts.fontSize),this._opts.fontColor&&(this._html.contentWrapper.style.color=this._opts.fontColor),this._opts.pointer&&!0!==this._opts.pointer&&(this._opts.shadow&&(this._html.shadowPointer.style.width=this._opts.pointer,this._html.shadowPointer.style.height=this._opts.pointer),this._html.pointerBorder&&(this._html.pointerBorder.style.borderWidth=this._opts.pointer),this._html.pointerBg.style.borderWidth=this._opts.pointer),this._opts.border){var o=0;if(void 0!==this._opts.border.width&&(o=a(this._opts.border.width,"0px"),this._html.contentWrapper.style.borderWidth=o.value+o.units),o=a((o=Math.round((this._html.contentWrapper.offsetWidth-this._html.contentWrapper.clientWidth)/2))+"px","0px"),this._opts.pointer){var s=Math.min(this._html.pointerBorder.offsetHeight,this._html.pointerBorder.offsetWidth);s=a(s+"px","0px");var h,p=Math.round(o.value*(1.41421356237-1));p=Math.min(p,s.value),this._html.pointerBg.style.borderWidth=s.value-p+s.units;var l=c((h=this._opts.placement,"top"===h?"bottom":"bottom"===h?"top":"left"===h?"right":"right"===h?"left":h));this._html.pointerBg.style["margin"+l]=p+o.units,this._html.pointerBg.style[this._opts.placement]=-o.value+o.units}var d=this._opts.border.color;d&&(this._html.contentWrapper.style.borderColor=d,this._html.pointerBorder&&(this._html.pointerBorder.style["border"+c(this._opts.placement)+"Color"]=d))}if(this._opts.shadow){var u=this._opts.shadow,f=function t(e){var i=u[e];return void 0!==i&&null!=i};if(f("h")||f("v")||f("blur")||f("spread")||f("color")){var m=a(u.h,r.h),v=a(u.v,r.v),g=a(u.blur,r.blur),w=a(u.spread,r.spread),y=u.color||r.color,b=function t(e,i){return e+" "+i+" "+g.original+" "+w.original+" "+y};this._html.shadowFrame.style.boxShadow=b(m.original,v.original);var k=.7071067811865474*(m.value-v.value)+m.units,$=.7071067811865474*(m.value+v.value)+v.units;this._html.shadowPointerInner&&(this._html.shadowPointerInner.style.boxShadow=b(k,$))}this._opts.shadow.opacity&&(this._html.shadowWrapper.style.opacity=this._opts.shadow.opacity)}var C=this.getProjection().fromLatLngToDivPixel(this._position||this._marker.position);C&&(this._html.floatWrapper.style.top=Math.floor(C.y)+"px",this._html.floatWrapper.style.left=Math.floor(C.x)+"px"),this._isOpen||(this._isOpen=!0,this.resize(),this.reposition(),this.activateCallback("afterOpen"),google.maps.event.trigger(this.getMap(),n+"opened",this))}}},{key:"onAdd",value:function t(){var e=this;if(!this._html){var i=function t(e,i){if(e&&i)for(var o=0;o<i.length;o++){var s=i[o];s&&(e.className&&(e.className+=" "),e.className+="si-"+s)}},o=function t(){for(var e=arguments.length,o=Array(e),s=0;s<e;s++)o[s]=arguments[s];var n=document.createElement("div");return i(n,o),n};if(this._html={},this._html.wrapper=o(),this.setWrapperClass(this._opts.wrapperClass),this._opts.shadow&&(this._html.shadowWrapper=o("shadow-wrapper-"+this._opts.placement),this._html.shadowFrame=o("frame","shadow-frame"),this._html.shadowWrapper.appendChild(this._html.shadowFrame),this._opts.pointer&&(this._html.shadowPointer=o("shadow-pointer-"+this._opts.placement),this._html.shadowPointerInner=o("shadow-inner-pointer-"+this._opts.placement),this._html.shadowPointer.appendChild(this._html.shadowPointerInner),this._html.shadowWrapper.appendChild(this._html.shadowPointer)),this._html.wrapper.appendChild(this._html.shadowWrapper)),this._html.contentWrapper=o("frame","content-wrapper"),this._html.content=o("content"),this._opts.content&&l(this._html.content,this._opts.content),this._opts.showCloseButton){if(this._opts.closeButtonMarkup){var s=document.createElement("div");l(s,this._opts.closeButtonMarkup),this._html.closeButton=s.firstChild}else this._html.closeButton=document.createElement("button"),this._html.closeButton.setAttribute("type","button"),this._html.closeButton.innerHTML="&#215;",i(this._html.closeButton,["close-button"]);this._html.contentWrapper.appendChild(this._html.closeButton)}this._html.contentWrapper.appendChild(this._html.content),this._html.wrapper.appendChild(this._html.contentWrapper),this._opts.pointer&&(this._opts.border&&(this._html.pointerBorder=o("pointer-"+this._opts.placement,"pointer-border-"+this._opts.placement),this._html.wrapper.appendChild(this._html.pointerBorder)),this._html.pointerBg=o("pointer-"+this._opts.placement,"pointer-bg-"+this._opts.placement),this._html.wrapper.appendChild(this._html.pointerBg)),this._html.floatWrapper=o("float-wrapper"),this._html.floatWrapper.appendChild(this._html.wrapper),this.getPanes().floatPane.appendChild(this._html.floatWrapper);var r=this.getMap();this.clearListeners(),this._opts.closeOnMapClick&&this.trackListener(google.maps.event.addListener(r,"click",function(){e.close()})),this._opts.closeWhenOthersOpen&&this.trackListener(google.maps.event.addListener(r,n+"opened",function(t){e!==t&&e.close()})),this._previousWidth=null,this._previousHeight=null,this.trackListener(google.maps.event.addListener(r,"bounds_changed",function(){var t=r.getDiv(),i=t.offsetWidth,o=t.offsetHeight,s=e._previousWidth,n=e._previousHeight;(null===s||null===n||s!==i||n!==o)&&(e._previousWidth=i,e._previousHeight=o,e.resize())})),this._marker&&this.trackListener(google.maps.event.addListener(this._marker,"position_changed",function(){e.draw()})),this._opts.showCloseButton&&!this._opts.closeButtonMarkup&&this.trackListener(google.maps.event.addDomListener(this._html.closeButton,"click",function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),e.close()})),["click","dblclick","rightclick","contextmenu","drag","dragend","dragstart","mousedown","mouseout","mouseover","mouseup","touchstart","touchend","touchmove","wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"].forEach(function(t){e.trackListener(google.maps.event.addDomListener(e._html.wrapper,t,function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()}))}),this.activateCallback("open")}}},{key:"onRemove",value:function t(){if(this.activateCallback("close"),this._html){var e=this._html.floatWrapper.parentElement;e&&e.removeChild(this._html.floatWrapper),this._html=null}this._isOpen=!1,this.activateCallback("afterClose")}},{key:"getMapInnerBounds",value:function t(){var e=this.getMap().getDiv().getBoundingClientRect(),i={top:e.top+this._opts.edgeOffset.top,right:e.right-this._opts.edgeOffset.right,bottom:e.bottom-this._opts.edgeOffset.bottom,left:e.left+this._opts.edgeOffset.left};return i.width=i.right-i.left,i.height=i.bottom-i.top,i}},{key:"reposition",value:function t(){if(this._opts.panOnOpen&&this._html){var e=this.getMapInnerBounds(),i=this._html.wrapper.getBoundingClientRect(),o=0,s=0;e.left>=i.left?o=i.left-e.left:e.right<=i.right&&(o=i.left-(e.right-i.width)),e.top>=i.top?s=i.top-e.top:e.bottom<=i.bottom&&(s=i.top-(e.bottom-i.height)),(0!==o||0!==s)&&this.getMap().panBy(o,s)}}},{key:"resize",value:function t(){if(this._html){var e=this.getMapInnerBounds(),i=e.width;void 0!==this._opts.maxWidth&&(i=Math.min(i,this._opts.maxWidth)),i-=this._html.wrapper.offsetWidth-this._html.content.offsetWidth,this._html.content.style.maxWidth=i+"px";var o=e.height;void 0!==this._opts.maxHeight&&(o=Math.min(o,this._opts.maxHeight)),o-=this._html.wrapper.offsetHeight-this._html.content.offsetHeight,this._html.content.style.maxHeight=o+"px"}}}]),e}("undefined"!=typeof google?google.maps.OverlayView:function t(){});e.default=u,t.exports=e.default});
